import{c as j,j as e,h as x,r as l,t as h,u as g,D as U,G as f,R as P,d as D,e as _,b as k}from"./index-CeQ_7HA2.js";import{D as y}from"./data-table-LorA5bIz.js";import{P as E}from"./page-header-YNPf6UAV.js";import{G as v}from"./geo-input-BBVxjaZv.js";import{F as G,P as S}from"./form-dialog-DtrkgT1B.js";import{K as M}from"./key-round-pcqFjGMt.js";import{E as A}from"./eye-CZSEa0nN.js";import{P as w}from"./plus-DoolWeGV.js";import"./input-DRQBVYz2.js";import"./scroll-area-Mw2U67h-.js";import"./index-BdQq_4o_.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],R=j("graduation-cap",O);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]],N=j("user-round",$);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],K=j("users",I);function C({open:n,onOpenChange:r,isProcessing:s=!1,isEdit:a=!1,toEditUsername:t,values:c,setValues:i,onClick:o,onDeleteClick:m,trigger:p,role:d}){return e.jsxs(G,{open:n,onOpenChange:r,isProcessing:s,isEdit:a,title:a?`Edit ${x.decode(t)}`:`Tambah Akun ${d==="teacher"?"Guru":"Siswa"}`,icon:e.jsx(N,{}),onSubmit:o,onDelete:m,trigger:p,children:[e.jsx(v,{id:"username",label:"Username",value:x.decode(c.username??""),onChange:u=>i({...c,username:u.target.value}),icon:e.jsx(N,{}),description:"Username harus unik dan terdiri dari minimal 3 karakter."}),e.jsx(v,{id:"password",label:"Password",value:c.password??"",onChange:u=>i({...c,password:u.target.value}),icon:e.jsx(M,{}),description:a?"Kosongkan jika tidak ingin mengubah password.":"Password harus terdiri dari minimal 8 karakter."})]})}function b({trigger:n,role:r,onSuccess:s}){const[a,t]=l.useState(!1),[c,i]=l.useState(!1),[o,m]=l.useState({username:"",password:"",role:r}),p=async()=>{if(!o.username||!o.password){h.error("Username dan password harus terisi!");return}i(!0);try{const d={...o,username:x.encode(o.username)},u=await g.createUser(d);h.success(`Pengguna "${x.decode(u.user.username)}" berhasil ditambahkan!`),m({username:"",password:"",role:r}),s(),t(!1)}catch(d){h.error("Gagal menambahkan: "+d.message)}finally{i(!1)}};return e.jsx("div",{children:e.jsx(C,{isProcessing:c,values:o,setValues:m,onClick:p,trigger:n,role:r,open:a,onOpenChange:t})})}function T({open:n,setOpen:r,user:s,onSuccess:a,onDeleteClick:t}){const[c,i]=l.useState(!1),[o,m]=l.useState({username:x.decode(s.username)});l.useEffect(()=>{m({username:x.decode(s.username)})},[s]);const p=async()=>{if(!o.username){h.error("Username tidak boleh kosong!");return}i(!0);try{const d={...o,username:x.encode(o.username)},u=await g.updateUser(s._id,d);h.success(`Pengguna "${x.decode(u.user.username)}" berhasil diperbarui!`),a(),r(!1)}catch(d){h.error("Gagal memperbarui: "+d.message)}finally{i(!1)}};return e.jsx("div",{children:e.jsx(C,{open:n,onOpenChange:r,isProcessing:c,isEdit:!0,toEditUsername:s?.username,values:o,setValues:m,onClick:p,onDeleteClick:t})})}function z({open:n,onOpenChange:r,user:s,onSuccess:a}){const[t,c]=l.useState(!1),i=async()=>{c(!0);try{await g.deleteUser(s._id),h.success(`Berhasil menghapus pengguna "${s.username}"`),a(),r(!1)}catch(o){h.error("Gagal menghapus: "+o.message)}finally{c(!1)}};return e.jsx("div",{children:e.jsx(U,{open:n,onOpenChange:r,onDeleteClick:i,isProcessing:t,item:`Pengguna "${s.username}"`})})}function F({teachers:n,onEdit:r}){return l.useMemo(()=>[{id:"no",header:()=>e.jsx("div",{className:"text-center font-bold",children:"No"}),cell:({row:s})=>{const a=n?.users.findIndex(t=>t._id===s.original._id)??-1;return e.jsx("div",{className:"text-center",children:(n?.users.length??0)-a})}},{id:"username",accessorKey:"username",header:()=>e.jsx("div",{className:"text-start font-bold",children:"Username"}),cell:({row:s})=>e.jsx("div",{className:"text-start",children:x.decode(s.original.username)})},{id:"actions",header:()=>e.jsx("div",{className:"text-end font-bold pe-8",children:"Aksi"}),cell:({row:s})=>{const a=s.original;return e.jsx("div",{className:"flex justify-end px-2",children:e.jsxs(f,{onClick:()=>r(a),variant:"secondary",className:"h-[40px] w-[80px]",children:[e.jsx(S,{})," Edit"]})})}}],[n,r])}function L({students:n,onEdit:r}){return l.useMemo(()=>[{id:"no",header:()=>e.jsx("div",{className:"text-center font-bold",children:"No"}),cell:({row:s})=>{const a=n?.users.findIndex(t=>t._id===s.original._id)??-1;return e.jsx("div",{className:"text-center",children:(n?.users.length??0)-a})}},{id:"username",accessorKey:"username",header:()=>e.jsx("div",{className:"text-start font-bold",children:"Username"}),cell:({row:s})=>e.jsx("div",{className:"text-start",children:x.decode(s.original.username)})},{id:"actions",header:()=>e.jsx("div",{className:"text-end font-bold pe-22",children:"Aksi"}),cell:({row:s})=>{const a=s.original;return e.jsxs("div",{className:"flex justify-end pe-4 space-x-4",children:[e.jsxs(f,{to:P.users.userDetail(a._id),variant:"primary",className:"h-[40px] w-[80px]",children:[e.jsx(A,{})," Lihat"]}),e.jsxs(f,{onClick:()=>r(a),variant:"secondary",className:"h-[40px] w-[80px]",children:[e.jsx(S,{})," Edit"]})]})}}],[n,r])}function se(){const n=D(),{students:r,teachers:s}=_.useLoaderData(),[a,t]=l.useState(null),[c,i]=l.useState(!1),[o,m]=l.useState(!1),p=F({teachers:s,onEdit:u=>{t(u),i(!0)}}),d=L({students:r,onEdit:u=>{t(u),i(!0)}});return e.jsxs("div",{className:"flex flex-col flex-grow px-4 md:px-16 space-y-4",children:[e.jsx(E,{title:"Manajemen Akun",description:"Kelola akun pada platform GeoViz.",colorScheme:"teal"}),e.jsxs("div",{className:"flex flex-col flex-grow xl:flex-row md:space-x-4 space-y-4 xl:space-y-0",children:[e.jsx(k,{icon:e.jsx(R,{}),title:"Akun Siswa",content:e.jsx(y,{columns:d,data:r?.users??[]}),header:e.jsx(b,{trigger:e.jsxs(f,{className:"w-full md:w-fit",variant:"secondary",children:[e.jsx(w,{})," Tambah"]}),role:"student",onSuccess:()=>n.invalidate()})}),s&&e.jsx(k,{icon:e.jsx(K,{}),title:"Akun Guru",content:e.jsx(y,{columns:p,data:s?.users??[]}),header:e.jsx(b,{trigger:e.jsxs(f,{className:"w-full md:w-fit",variant:"secondary",children:[e.jsx(w,{})," Tambah"]}),role:"teacher",onSuccess:()=>n.invalidate()})})]}),a&&e.jsx(T,{open:c,setOpen:i,user:a,onSuccess:()=>{t(null),n.invalidate()},onDeleteClick:()=>{m(!0)}}),a&&e.jsx(z,{open:o,onOpenChange:()=>{m(!1)},user:a,onSuccess:()=>{t(null),n.invalidate()}})]})}export{se as component};
